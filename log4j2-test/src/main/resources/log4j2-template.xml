<?xml version="1.0" encoding="UTF-8"?>
<Configuration status="WARN" strict="true">

  <Properties>
    <!--logging.file.path已包含了project.name-->
    <Property name="base.path">${sys:logging.file.path}</Property>
    <Property name="project.name">${sys:project.name}</Property>

    <!--prefix-->
    <Property name="primary.file.prefix">${base.path}/${project.name}</Property>
    <Property name="warn.file.prefix">${base.path}/${project.name}-warn</Property>
    <Property name="error.file.prefix">${base.path}/${project.name}-error</Property>
    <!--suffix-->
    <Property name="file.name.suffix">.log</Property>

    <!--file-->
    <Property name="primary.file.name">${primary.file.prefix}${file.name.suffix}</Property>
    <Property name="warn.file.name">${warn.file.prefix}${file.name.suffix}</Property>
    <Property name="error.file.name">${error.file.prefix}${file.name.suffix}</Property>

    <!--layout-->
    <Property name="layout">%d %level %X{traceId} [%t] %c{10}:%M:%L %m%n</Property>
  </Properties>

  <Appenders>
    <Console name="Console" target="SYSTEM_OUT">
      <PatternLayout pattern="${layout}"/>
    </Console>

    <RollingRandomAccessFile name="primaryLogFile"
      immediateFlush="true" fileName="${primary.file.name}"
      filePattern="${primary.file.prefix}-%d{yyyy-MM-dd-HH}-%i.log.gz">
      <PatternLayout pattern="${layout}"/>
      <Policies>
        <SizeBasedTriggeringPolicy size="100 MB" />
        <TimeBasedTriggeringPolicy/>
      </Policies>
      <DefaultRolloverStrategy>
        <Delete basePath="${base.path}" maxDepth="1">
          <IfFileName glob="${project.name}-*.log.gz" />
          <!--这里的age必须和filePattern协调, 后者是精确到HH, 这里就要写成xH, xd就不起作用
          另外, 数字最好>2, 否则可能造成删除的时候, 最近的文件还处于被占用状态,导致删除不成功!-->
          <IfLastModified age="168H" />
        </Delete>
      </DefaultRolloverStrategy>
    </RollingRandomAccessFile>

    <RollingRandomAccessFile name="warnLogFile"
      immediateFlush="true" fileName="${warn.file.name}"
      filePattern="{warn.file.prefix}-%d{yyyy-MM-dd}-%i.log.gz">
      <PatternLayout pattern="${layout}"/>
      <ThresholdFilter level="warn"/>
      <Policies>
        <SizeBasedTriggeringPolicy size="100 MB" />
        <TimeBasedTriggeringPolicy/>
      </Policies>
      <DefaultRolloverStrategy>
        <Delete basePath="${base.path}" maxDepth="1">
          <IfFileName glob="${project.name}-warn-*.log.gz" />
          <IfLastModified age="7d" />
        </Delete>
      </DefaultRolloverStrategy>
    </RollingRandomAccessFile>

    <RollingRandomAccessFile name="errorLogFile"
      immediateFlush="true" fileName="${error.file.name}"
      filePattern="${error.file.prefix}-%d{yyyy-MM-dd}.log">
      <PatternLayout pattern="${layout}"/>
      <ThresholdFilter level="error"/>
      <Policies>
        <SizeBasedTriggeringPolicy size="100 MB" />
        <TimeBasedTriggeringPolicy/>
      </Policies>
      <DefaultRolloverStrategy>
        <Delete basePath="${base.path}" maxDepth="1">
          <IfFileName glob="${project.name}-error-*.log.gz" />
          <IfLastModified age="7d" />
        </Delete>
      </DefaultRolloverStrategy>
    </RollingRandomAccessFile>
  </Appenders>

  <Loggers>
    <Logger name="com.alibaba.dubbo" level="warn"/>

    <!--<Logger name="com.hyxf"-->
      <!--level="info" additivity="false">-->
      <!--<AppenderRef ref="**"/>-->
    <!--</Logger>-->

    <Root level="info">
      <AppenderRef ref="Console" level="${sys:logging.console.level:-off}"/>
      <AppenderRef ref="primaryLogFile"/>
      <AppenderRef ref="warnLogFile"/>
      <AppenderRef ref="errorLogFile"/>
    </Root>
  </Loggers>
</Configuration>